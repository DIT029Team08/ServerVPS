<!DOCTYPE html>
<html>
<head>
	<title>DIT029 Simulator</title>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<!-- <meta content="utf-8" http-equiv="encoding"> -->
	<link rel="stylesheet" type="text/css" href="./static/resources/styles/main.css">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300" rel="stylesheet"> 
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	<script src="./static/jquery.min.js"></script>
	<script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
	<script src="./static/resources/js/inputFile.js"></script>
</head>
 
<body>
	<main>
		<div class="container">
			<div class="jumbotron">
				<h1>DIT029 Simulator</h1>
			</div> 
			<div class="welcomeText">
				<h2>Please select a JSON File</h2>
				<h6>Ensure that the contents follow the DIT029 Template<br> for a Sequence Diagram</h6>
			</div>
			<form class="fileForm" name="fileForm" action="./static/resources/pages/animationPage.html" method="get">
				<input class="fileInput" name="file" type="file" id="JSONFile" accept=".json" required>
				<button type="submit">Submit</button>
			</form>
		</div>
	   
	</main>

	<script type="text/javascript">
      
      var websocket;
      $(document).ready(init);
      
      function init() {
          $('#server').val("ws://" + window.location.host + "/websocket");
          if(!("WebSocket" in window)){  
              $('#status').append('<p><span style="color: red;">websockets are not supported </span></p>');
              $("#navigation").hide();  
          } else {
              $('#status').append('<p><span style="color: green;">websockets are supported </span></p>');
              connect();
          };
              $("#connected").hide(); 	
              $("#content").hide(); 	
      };
      function connect()
      {
          wsHost = $("#server").val()
          websocket = new WebSocket(wsHost);
          showScreen('<b>Connecting to: ' +  wsHost + '</b>'); 
          websocket.onopen = function(evt) { onOpen(evt) }; 
          websocket.onclose = function(evt) { onClose(evt) }; 
          websocket.onmessage = function(evt) { onMessage(evt) }; 
          websocket.onerror = function(evt) { onError(evt) }; 
      };  
      
      function disconnect() {
          websocket.close();
      }; 
      function toggle_connection(){
          if(websocket.readyState == websocket.OPEN){
              disconnect();
          } else {
              connect();
          };
      };
      function sendTxt() {
          if(websocket.readyState == websocket.OPEN){
              txt = $("#send_txt").val();
              websocket.send(txt);
              showScreen('sending: ' + txt); 
          } else {
               showScreen('websocket is not connected'); 
          };
      };
      function onOpen(evt) { 
          showScreen('<span style="color: green;">CONNECTED </span>'); 
          $("#connected").fadeIn('slow');
          $("#content").fadeIn('slow');
      };  
      function onClose(evt) { 
          showScreen('<span style="color: red;">DISCONNECTED </span>');
      };  
      function onMessage(evt) { 
          showScreen('<span style="color: blue;">RESPONSE: ' + evt.data+ '</span>'); 
      };  
      function onError(evt) {
          showScreen('<span style="color: red;">ERROR: ' + evt.data+ '</span>');
      };
      function showScreen(txt) { 
          $('#output').prepend('<p>' + txt + '</p>');
      };
      function clearScreen() 
      { 
          $('#output').html("");
      };
    </script>
  <!-- </head> -->

  <!-- <body> -->
    <div id="header">
      <h1>Websocket client</h1>
      <div id="status"></div>
    </div>


    <div id="navigation">

      <p id="connecting">
	<input type='text' id="server" value=""></input>
	<button type="button" onclick="toggle_connection()">connection</button>
      </p>
      <div id="connected">				
	<p>
	  <input type='text' id="send_txt" value=></input>
	  <button type="button" onclick="sendTxt();">send</button>
	</p>
      </div>

      <div id="content">						
	<button id="clear" onclick="clearScreen()" >Clear text</button>
	<div id="output"></div>
      </div>

</div>


	<!-- <script type="text/javascript" src="./resources/js/app.js"></script> -->
	
</body>
</html>